<!DOCTYPE html>
<html lang="en"
      th:replace="~{fragments/main-layout :: main-layout(~{::title}, ~{::.content})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Login</title>
</head>
<body>

<div class="content">
    <div class="row justify-content-center mt-4">
        <div class="col-md-6 col-lg-5">

            <div class="alert alert-success alert-dismissible fade show"
                 role="alert"
                 th:if="${param.reg_success}">
                You have successfully registered! Please log in.
                <button aria-label="Close" class="btn-close"
                        data-bs-dismiss="alert"
                        type="button"></button>
            </div>
            <div class="alert alert-info alert-dismissible fade show"
                 role="alert"
                 th:if="${param.logout}">
                You have been logged out.
                <button aria-label="Close" class="btn-close"
                        data-bs-dismiss="alert"
                        type="button"></button>
            </div>
            <div class="alert alert-danger alert-dismissible fade show"
                 role="alert"
                 th:if="${param.error} or ${error}">
                <span th:if="${param.error}">Invalid username or password.</span>
                <span th:if="${error}" th:text="${error}"></span>
                <button aria-label="Close" class="btn-close"
                        data-bs-dismiss="alert" type="button"></button>
            </div>

            <div class="alert alert-success alert-dismissible fade show"
                 role="alert" th:if="${message}">
                <span th:text="${message}"></span>
                <button aria-label="Close" class="btn-close"
                        data-bs-dismiss="alert" type="button"></button>
            </div>

            <div class="card shadow-sm">
                <div class="card-header text-center bg-dark text-white">
                    <h3 class="mb-0">Login</h3>
                </div>
                <div class="card-body p-4">
                    <form method="post" th:action="@{/login}">
                        <input name="redirectUrl" th:if="${redirectUrl}"
                               th:value="${redirectUrl}"
                               type="hidden"/>

                        <div class="mb-3">
                            <label class="form-label"
                                   for="username">Username</label>
                            <input autocomplete="username" autofocus
                                   class="form-control" id="username"
                                   name="username"
                                   placeholder="Enter username" required
                                   type="text">
                        </div>

                        <div class="mb-4">
                            <label class="form-label"
                                   for="password">Password</label>
                            <div>
                                <div class="input-group">
                                    <input autocomplete="current-password"
                                           class="form-control"
                                           id="password" name="password"
                                           placeholder="Password"
                                           required type="password">
                                    <button class="btn btn-outline-secondary"
                                            id="togglePassword" type="button">
                                        <i class="bi bi-eye-slash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3 form-check">
                            <input class="form-check-input" id="remember-me"
                                   name="remember-me" type="checkbox">
                            <label class="form-check-label" for="remember-me">
                                Remember me</label>
                        </div>

                        <div class="text-end mb-4">
                            <a class="text-muted" th:href="@{/forgot-password}">
                                <small>Forgot password?</small>
                            </a>
                        </div>

                        <div class="d-grid">
                            <button class="btn btn-primary btn-lg"
                                    type="submit">Login
                            </button>
                        </div>
                    </form>
                </div>

                <div class="card-footer text-center py-3">
                    <small>Don't have an account?
                        <a th:href="@{/register}">Register here</a>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const togglePassword = document.querySelector('#togglePassword');
            const password = document.querySelector('#password');
            const eyeIcon = togglePassword.querySelector('i');

            togglePassword.addEventListener('click', function () {
                const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
                password.setAttribute('type', type);

                eyeIcon.classList.toggle('bi-eye');
                eyeIcon.classList.toggle('bi-eye-slash');
            });
        });
    </script>
</div>
</body>
</html>
